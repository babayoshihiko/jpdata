.. index:: Digitizing, Topology, Geometry validity, Errors
   single: Plugins; Geometry checker

.. _geometry_checker:

ジオメトリとトポロジのチェック
==============================

ジオメトリとトポロジは、GIS の重要な概念です。
ジオメトリは、地物の形状と位置を定義し、トポロジは、地物間の空間関係を定義します。
詳細は、ベクタの章を参照してください。
QGIS には、ジオメトリとトポロジのエラーを検出および修正するための組み込みツールとプラグインが含まれています。このセクションでは、これらのツールとプラグインの使用方法について説明します。

ジオメトリをチェック
^^^^^^^^^^^^^^^^^^^^^
QGIS には、ジオメトリのエラーを検出および修正するための組み込みツールが含まれています。
ジオメトリをチェックするには、以下の手順を実行します。 

まず、ジオメトリをチェックするレイヤを選択します。
ここでは、jpData の河川データを使用します。

メニューバーのベクタから、ジオメトリをチェックを選択すると、以下のようなウィンドウが表示されます。

ここでポイントは、空の出力フォルダを用意しておくことです。
ここに、エラーのあるフィーチャが保存されます。
また、ジオメトリチェックのオプションを選びます。
ここでは、以下のように設定しました。  

.. figure:: img/plugin_geo_1.png
   :alt: ジオメトリをチェック
   :align: center

   実行をクリックします。
すると、以下のように、エラーのあるフィーチャが保存されます。

.. figure:: img/plugin_geo_2.png
   :alt: 結果
   :align: center

国土数値情報の河川データには、ジオメトリのエラーが含まれていることがわかります。
エラーのあるフィーチャを選択すると、以下のように、エラーの内容が表示されます。
実は、国土数値情報の河川データは小数点以下の桁数が多く、QGIS で扱うとジオメトリのエラーが発生することがあります。

ジオメトリをチェックのウィンドウに戻り、「許容範囲」を1E-10 として再実行すると、エラーがなくなります。

トポロジチェッカー
^^^^^^^^^^^^^^^^^^^^^

QGIS には、トポロジチェッカーというプラグインが含まれています。
このプラグインは、ジオメトリとトポロジのエラーを検出および修正するための強力なツールです。
トポロジチェッカーを使用するには、以下の手順を実行します。
まず、トポロジチェッカーを有効にします。
メニューバーのプラグインから、プラグインの管理とインストールを選びます。
トポロジチェッカーを検索して、有効にします。 

有効にすると、メニューバーのベクタにトポロジチェッカーのメニューが追加されます。
また、ツールバーにトポロジチェッカーのアイコンが追加されます。
トポロジチェッカーのアイコンをクリックすると、以下のようなパネルが表示されます。

.. figure:: img/plugin_geo_1.png
   :alt: トポロジチェッカー
   :align: center

トポロジチェッカーは、最初にルールを定義し、次にそのルールに基づいてエラーを検出するというステップをとります。
まず、ルールを追加しましょう。
ここでは、以下のルールを追加しました。

.. figure:: img/plugin_geo_3.png
   :alt: トポロジチェッカー
   :align: center

ルールを追加したら、実行ボタンをクリックします。

.. figure:: img/plugin_geo_4.png
   :alt: トポロジチェッカー
   :align: center

ここでは、エラーはありませんでした。
もしエラーがあった場合、エラーのあるフィーチャが選択されます。
エラーの内容は、パネルの下部に表示されます。
エラーのあるフィーチャをダブルクリックすると、マップキャンバスでそのフィーチャがズームされます。

ジオメトリチェッカーとトポロジチェッカー
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

どちらも、ジオメトリもトポロジもチェックできます。
ジオメトリチェッカーは、単一のレイヤを扱い、あらかじめ定義されたルールに基づいてエラーを検出します。
トポロジチェッカーは、複数のレイヤを扱うことができ、カスタムルールを定義できます。
どちらのツールを使用するかは、ユーザのニーズと好みによります。


.. Substitutions definitions - AVOID EDITING PAST THIS LINE
   This will be automatically updated by the find_set_subst.py script.
   If you need to create a new substitution manually,
   please add it also to the substitutions.txt file in the
   source folder.

.. |checkbox| image:: /static/common/checkbox.png
   :width: 1.3em
.. |fromSelectedFeature| image:: /static/common/mActionFromSelectedFeature.png
   :width: 1em
.. |geometryChecker| image:: /static/common/geometrychecker.png
   :width: 1.5em
.. |options| image:: /static/common/mActionOptions.png
   :width: 1em
.. |radioButtonOff| image:: /static/common/radiobuttonoff.png
   :width: 1.5em
.. |radioButtonOn| image:: /static/common/radiobuttonon.png
   :width: 1.5em
.. |selectNumber| image:: /static/common/selectnumber.png
   :width: 2.8em
.. |selectString| image:: /static/common/selectstring.png
   :width: 2.5em
.. |success| image:: /static/common/mIconSuccess.png
   :width: 1em
