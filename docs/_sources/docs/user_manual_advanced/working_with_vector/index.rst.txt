.. _label_workingvector:

**************************
ベクタデータの操作
**************************

.. toctree::
   :maxdepth: 2



ベクタデータは、それぞれの地物に対して基本的には位置のデータがあるだけです。点の大きさや線の色、ポリゴンの塗りつぶし色などの情報はありません。

QGISでは、ベクタをレイヤとして追加すると、その際に色・太さ、ポリゴンであればハッチングなどの「見た目」を定義します。これを「シンボル」といいます。

さらに、属性情報から地物の名称や電話番号などの情報を表示することもできます。これを「ラベル」といいます。

「シンボル」や「ラベル」などの情報を総称して「スタイル」といいます。QGIS のプロジェクトファイルには、レイヤごとにスタイル情報を定義しています。プロジェクトファイルは、.qgs と .qgz がありますが、現時点では大きな違いはありません。

プロジェクトを.qgs形式で保存して、テキストエディタ（テキストエディタがない場合はGoogle Chrome などのブラウザ）で開いてみましょう。XML形式で書かれていることが確認できます。

ジオメトリとトポロジ
====================================

ジオメトリとトポロジ は、発展レベルです。QGIS 入門書にはほとんど書かれていません。ただし、データの整備に携わる際には必須の事項です。不正なジオメトリや不正なトポロジは、OGC標準で規定されています。

なお、ジオメトリが不正な場合、空間演算ツールが使用できないことがあります。

ジオメトリ演算

* ジオメトリ演算とは、線の長さを測ったり、ポリゴンの面積 (あるいは周長) を測ることが代表的です。
* データが線またはポリゴンの場合、属性テーブルに新たな列を作成し、距離や面積などを格納しておくことができます。

ジオメトリの修復 

* ベクタデータの中には、不正なジオメトリの地物が存在していることがあります。不正なジオメトリは、ジオメトリ演算や空間演算のエラーの原因になることがあります。

不正なジオメトリとは、
•
* 線のはずなのに、1点しかデータがない 
* ポリゴンの線が交差している
* ポリゴンなのに、3点が一直線上にある

などです。不正なジオメトリは、「ジオメトリチェッカー」または「トポロジをチェック」で調べることができます。プラグインのジオメトリチェッカーをインストールします。その後、メニューから「ベクタ > ジオメトリをチェック」を選択します。

最初の例の場合は、QGIS は地物を削除します。2番目の例では、手作業で直す必要が出てくる場合もあります。

トポロジの修復 

ジオメトリが地物の内部のことであるのに対し、トポロジは地物間の関係性を指します。

* 連続する二つの線が、一つの点で繋がっていない
* 接するはずの二つのポリゴンが、空間があったり重なり部分がある

ような時に、トポロジーのエラーがあります。以下の図は、後者の例です。

プラグインのトポロジーチェッカーをインストールします。その後、メニューから「ベクタ > トポロジーチェッカー」を選択します。

河川のジオメトリ
^^^^^^^^^^^^^^^^

宮城県の河川データをダウンロードし、ジオメトリをチェックしてみましょう。

ジオメトリチェッカー: エラー数 33

トポロジチェッカー: エラー数 0

河川データは、小数点以下の数値が非常に細かくなっています。
このため、ジオメトリチェッカーでエラーが出ることがあります。
この場合、ジオメトリチェッカーの「設定」ボタンを押して、許容誤差を大きくします。
例えば、`1E-6` から `1E-10`` に変更します。
この場合、エラー数は 0 になります。


